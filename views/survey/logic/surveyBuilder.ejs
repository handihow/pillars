<script>
	$(document).ready(function() {

	if (typeof SurveyEditor == "undefined") {
	   return console.log('survey editor model not defined');
	}

	SurveyEditor.StylesManager.applyTheme("winter");

	var isEditingMode = false;

	var surveyInfo; var surveyParsedInfo; var surveyId = ''; var isCompetenceSurvey; var isSoftwareSurvey;

	if($( '#surveyInfo' ).length>0){
		//edit mode

		isEditingMode = true;

		surveyInfo = $( '#surveyInfo' ).text();
		surveyParsedInfo = JSON.parse(surveyInfo);

		surveyId = surveyParsedInfo._id;

		isCompetenceSurvey = surveyParsedInfo.isCompetenceSurvey;
		isSoftwareSurvey = surveyParsedInfo.isSoftwareSurvey;
	}

	var competenceSurveyRatingQuestion = {
        name: "competencerating",
        isCopied: true,
        iconName: "icon-rating",
        title: "Rating",
        json: {
            "type": "rating",
            "rateValues": [
              {
                "value": "0",
                "text": {
                  "nl": "Nee"
                }
              },
              {
                "value": "0.25",
                "text": {
                  "nl": "Oneens"
                }
              },
              {
                "value": "0.5",
                "text": {
                  "nl": "Eens"
                }
              },
              {
                "value": "0.75",
                "text": {
                  "nl": "Meer eens"
                }
              },
              {
                "value": "1",
                "text": {
                  "nl": "Helemaal mee eens"
                }
              }
            ],
            "isRequired": true
        }
    }

	var editorOptions = {
		 // show the embeded survey tab. It is hidden by default
		 showEmbededSurveyTab : false,
		 // hide the test survey tab. It is shown by default
		 showTestSurveyTab : true,
		 // hide the JSON text editor tab. It is shown by default
		 showJSONEditorTab : false,
		 // show the "Options" button menu. It is hidden by default 
		 showOptions: false,
		 // question types shown
		 questionTypes: isCompetenceSurvey || isSoftwareSurvey ? ["boolean"] : ["text", "checkbox", "radiogroup", "dropdown", "rating", "boolean", "matrix", "matrixdropdown", "matrixdynamic", "multipletext", "panel", "paneldynamic"],

		 generateValidJSON: true,
	}; 

	var survey = new SurveyEditor.SurveyEditor("surveyEditorContainer", editorOptions);

	if(isCompetenceSurvey || isSoftwareSurvey){
		survey.toolbox.addItem(competenceSurveyRatingQuestion);
	}

	if(isEditingMode){
		survey.text = JSON.stringify(surveyParsedInfo.survey);
	} 
		
	var schoolId = $( '#schoolId').text() || null;

	//set function on save callback
	survey.saveSurveyFunc = function (saveNo, callback) {
		var surveyJson = JSON.parse(survey.text);
		var stringifiedJson = JSON.stringify(surveyJson);

		var surveyName = $('#surveyName').val();
		var isPublicSurvey = true;

		if($('#isPublicSurvey').is(":checked")) {
			isPublicSurvey = false
		};

		var isActiveSurvey = false;
		if($('#isActiveSurvey').is(":checked")) {
			isActiveSurvey = true
		};

		console.log(isActiveSurvey);

		var url = window.location.origin + "/survey/" + surveyId

		if(schoolId){
			url = window.location.origin + "/schools/" + schoolId + "/survey/" + surveyId
		}

		console.log(url);
	    $.ajax({
	        url: url,
	        type: "POST",
	        data: {
	            surveyText: stringifiedJson,
	            name: surveyName,
	            isPublic: isPublicSurvey,
	            isActive: isActiveSurvey
	        },
	        success: function (data) {
	        	if(data.success){
	        		window.location.href = data.redirect;
	        	} else {
	        		alert(data.error);
	        	}
	        },
	        error: function(err) {
	        	alert('Er ging iets mis');
	        }
	    });
	};


	$('.svd_commercial_container').hide();


	});
</script>