<script>
	$(document).ready(function() {
		
		$('#nonactive-content').hide();

		var surveysInfo = $( '#surveysInfo' ).text();

		var surveys = JSON.parse(surveysInfo || '[]');

		var resultsInfo = $( '#resultsInfo' ).text();

		var results = JSON.parse(resultsInfo || '[]');

		var averages = results.map(r => r.average);

		var comparingAverages = results.map(r => r.comparingAverage);

		surveys.forEach(function(survey, index){
			if(averages[index]){
				var data = [
				  {
				    type: "indicator",
				    mode: "number+gauge+delta",
				    number: { suffix: ' %' },
				    gauge: { 
				    	shape: "bullet",
				    	axis: {
					        visible: true,
					        range: [0, 100]
					    },
					    bar: {
					    	color: averages[index] > survey.minimumLevel ? '#009FE3' : '#E30613'
					    }
				    },
				    delta: { reference: comparingAverages[index], relative: false },
				    value: averages[index],
				    domain: { x: [0, 1], y: [0, 1] },
				    title: { text: 'Test ' + (index + 1) }
				  }
				];
				// var layout = { width: 500, height: 250 };
				var layout = {
				  width: 450,
				  height: 100,
				  margin: { t: 10, b: 25, l: 5, r: 0 }
				};

				var config = {
			      displayModeBar: false,
			      staticPlot: true,
			      responsive: true
			    };

				Plotly.newPlot(index.toString(), data, layout, config);
			}
			
		});

	    $('#hideshow').on('click', function(event) {        
	         $('#nonactive-content').toggle('show');
	    });
	
	});
</script>