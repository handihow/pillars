<% include ../partials/header %>
<% include ../partials/main-menu %>
<% include ../partials/flash-message %>
<% include ../partials/school-header %>

    <div class="html-content">
      <div class="ui grid">
        <div class="twelve wide column">
          <h2 class="ui header">
            <%if(school.logo || school.uploadedLogo){%><img 
                  class="ui image" 
                  src="<%=school.uploadedLogo ? school.uploadedLogo : school.logo %>"><%}%>
            <div class="content">
              <%= school.name %>
            </div>
          </h2>
        </div>
        <div class="two wide column">
          <button class="ui primary button" id="cmd"><i class="print icon"></i>PDF</button>
        </div>
        <div class="two wide column">
          <h2 class="ui right aligned header">
            <a href="/schools/<%=school._id%>/pillars/settings">
            <i class="setting icon"></i>
            </a>
          </h2>
        </div>
      </div>
      <div class="ui divider"></div>
      <% if(result.errors && result.errors.length > 0) { %>
        <div class="ui red message">
          <ul>
          <%result.errors.forEach(function(errorMessage){%>
            <li><%=errorMessage%></li>
          <%})%>
          </ul>
        </div>
      <% } %>
      <!-- RESULT VARIABLE -->   
      <div id="result" data-value="<%=JSON.stringify(result)%>"></div>   
      <!-- TOTAL SCORE -->
      <% var generalStatistics = [{'id': 'hardware', 'label': 'Hardware', 'color': 'red'},{'id': 'software', 'label': 'Digitale leermiddelen', 'color': 'blue'},{'id': 'competence', 'label': 'Deskundigheid', 'color': 'yellow'},{'id': 'management', 'label': 'Organisatie', 'color': ''}]%>
      <% var lowestSubject; var highestSubject; var lowestScore = 5; var highestScore = 0; var tmp; var difference;%>
      <% generalStatistics.forEach(function(stat, i){
         tmp = result.total[stat.id];
         if (tmp < lowestScore) {
           lowestScore = tmp;
           lowestSubject = generalStatistics[i].label;
         } else if (tmp > highestScore){
            highestScore = tmp;
            highestSubject = generalStatistics[i].label;
         }
         difference = highestScore - lowestScore;
      })%>
      <div class="ui horizontal divider">
        Pillars Score
      </div>
      <h3 class="ui header">Basis van deze berekening</h3>
      <p>Pillars heeft een score berekend voor <%=school.name%> op basis van de standaard die is ingesteld bij deze school, genaamd <strong><%=result.standard.name%></strong>. In deze standaard zijn telkens 5 punten te verdienen op de hoofdonderdelen Hardware, Digitale Leermiddelen, Deskundigheid en Organisatie. In deze standaard zijn veel verschillende instellingen opgenomen, zoals de te verdienen punten per onderwerp en de voorwaarden die gesteld worden aan bijvoorbeeld devices of digitale leermiddelen. Bij de <a href="/schools/<%=school._id%>/pillars/settings">instellingen</a> kun je de standaard bekijken en ook wijzigen.</p>
       <h3 class="ui header">Interpretatie van resultaten</h3>
      <p>Bij ieder onderdeel is er een uitleg van de behaalde score. Vervolgens staan de behaalde punten op ieder onderdeel aan de linkerkant van de grafiek.
      De resultaten zijn grafisch op een polair vlakdiagram weergegeven. Op de cirkelas staat het percentage van het maximale aantal punten dat is behaald. In de taartpunt wordt het absolute aantal punten gepresenteerd, met tussen haakjes het maximale aantal punten.</p>
      <h3 class="ui header">Score op hoofdonderdelen</h3>
      <p>Het Vier in balans-model van Kennisnet laat zien hoe scholen optimaal rendement kunnen halen uit ict. Wanneer deze voorwaarden met elkaar in balans zijn, kunnen scholen de gewenste opbrengsten op het gebied van ict bereiken. Het is belangrijk om te streven naar goede scores op ieder afzonderlijk onderdeel, maar zeker ook om ervoor te zorgen dat er een goede balans is tussen de hoofdonderdelen. De laagste score heeft <%=school.name%> behaald op het onderdeel <%=lowestSubject%> (<%=lowestScore.toFixed(1).replace('.', ',')%> punten) en de hoogste score op het onderdeel <%=highestSubject%> (<%=highestScore.toFixed(1).replace('.', ',')%> punten).
      <%if(difference>1){%>
        Het verschil tussen het laagste en het hoogste onderdeel is meer dan een vol punt. Wij raden aan om snel in te zetten op verbetering van het onderdeel <%=lowestSubject%>. Je kunt aanknopingspunten hiervoor vinden in dit overzicht.</p>
      <%} else {%>
        Het verschil tussen het laagste en het hoogste onderdeel is minder dan een vol punt. Dit wijst op een redelijke balans tussen de hoofdonderdelen. Wij raden je aan om het rapport in detail door te lezen en verdere aanknopingspunten tot verbetering te ontdekken.</p>
      <%}%>
      <div class="ui stackable grid">
        <div class="five wide column">
          <div class="ui horizontal small statistics">
            <%generalStatistics.forEach(function(generalStatistic){%>
              <div class="<%=generalStatistic.color%> statistic">
                <div class="value">
                  <%= result.total && result.total[generalStatistic.id]
                        ? result.total[generalStatistic.id].toFixed(1).replace('.', ',') : '0,0'%>
                </div>
                <div class="label">
                  <%=generalStatistic.label%>
                </div>
              </div>
            <%})%>            
          </div>
        </div>
        <div class="eleven wide column">
            <canvas id="total"></canvas>
        </div>
      </div>
      <!--HARDWARE-->
      <div class="ui horizontal divider">
        Hardware
      </div>
      <%if(result.errors.length === 0){%>
        <h3 class="ui header">Computers</h3>
        <p><%= result.standard.hardware.computersPerStudent.isComputer.join(', ')%> devices worden meegeteld als computer.
        De devices worden echter niet meegeteld als ze minder dan <%=result.standard.hardware.computersPerStudent.minRAM%> GB geheugen hebben,
          of als ze ouder zijn dan <%=result.standard.hardware.computersPerStudent.maxYear%> jaar.
        Het minimale aantal computers is vastgesteld op <strong><%=result.hardware.requiredComputers%></strong> op basis van <%= school.countStudents%> leerlingen maal 
          <%=result.standard.hardware.computersPerStudent.standard%>.
        Pillars heeft het totale aantal devices die voldoen aan de standaard op <%=school.name%> vastgesteld op <strong><%=result.hardware.goodComputers%></strong>.
        <%if(result.hardware.missingComputers === 0){%>
         Er zijn dus op dit moment voldoende computers aanwezig die voldoen aan de minimale eisen en de maximale score van 
          <%=result.standard.hardware.computersPerStudent.maxScore%> is op dit onderdeel toegekend.</p>
        <%} else {%>
          Er ontbreken dus <strong><%=result.hardware.missingComputers%></strong> devices op <%=school.name%>. Wij raden aan om de ontbrekende devices aan te schaffen. Op dit moment zijn slechts <%=result.hardware.computersPerStudent.toFixed(1)%> van maximaal <%=result.standard.hardware.computersPerStudent.maxScore%> punten toegekend op dit onderdeel.</p> 
        <%}%>
        <h3 class="ui header">Digitale schoolborden</h3>
        <%if(result.standard.hardware.digitalSchoolbordsPerClassroom.isTouchscreen === "1"){%>
          <p>Digitale schoolborden worden alleen meegeteld als ze touchscreen functionaliteit hebben.
        <%} else {%>
          <p>
        <%}%>
        Het minimale aantal digitale schoolborden is vastgesteld op <strong><%=result.hardware.requiredDigitalSchoolbords%></strong> op basis van <%= school.countClassrooms%> klaslokalen maal 
          <%=result.standard.hardware.digitalSchoolbordsPerClassroom.standard%>.
        Pillars heeft het totale aantal digitale schoolborden die voldoen aan de standaard op <%=school.name%> vastgesteld op <strong><%=result.hardware.goodDigitalSchoolbords%></strong>.
        <%if(result.hardware.missingDigitalSchoolbords === 0){%>
         Er zijn dus voldoende digitale schoolborden aanwezig en de maximale score van 
          <%=result.standard.hardware.digitalSchoolbordsPerClassroom.maxScore%> is op dit onderdeel toegekend.</p>
        <%} else {%>
          Er ontbreken dus <strong><%=result.hardware.missingDigitalSchoolbords%></strong> digitale schoolborden op <%=school.name%>. Wij raden aan om de ontbrekende apparaten aan te schaffen. Op dit moment zijn slechts 
            <%=result.hardware.digitalSchoolbordsPerClassroom.toFixed(1)%> van maximaal <%=result.standard.hardware.digitalSchoolbordsPerClassroom.maxScore%> punten toegekend op dit onderdeel.</p> 
        <%}%>
        <h3 class="ui header">Netwerk</h3>
        <p>Op het onderdeel netwerk zijn <%=result.standard.hardware.network.maxScore%> punt(en) te verdienen.
          Deze score wordt behaald als bij de <a href="/schools/<%=school._id%>">algemene instellingen</a> van <%=school.name%> "Ja" is geantwoord op de vragen "School heeft goed en betrouwbaar bedraad internet" en "School heeft goed en betrouwbaar draadloos internet".
          <%if(result.standard.hardware.network.maxScore == result.hardware.network){%>
            Dit is het geval en de maximale score van <%=result.standard.hardware.network.maxScore%> is op dit onderdeel toegekend.
          <%} else {%>
            Dit is het niet geval en er zijn dus geen punten op dit onderdeel toegekend.
          <%}%>
        </p>
        <h3 class="ui header">Draagbare computers</h3>
        <p>Op het onderdeel draagbare computers zijn <%=result.standard.hardware.laptopsPerSchool.maxScore%> punt(en) te verdienen. 
          <%if(Array.isArray(result.standard.hardware.laptopsPerSchool.isLaptop)){%>
               <%= result.standard.hardware.laptopsPerSchool.isLaptop.join(', ')%> devices worden meegeteld als draagbare computer, mits deze devices minder dan <%=result.standard.hardware.laptopsPerSchool.maxYear%> jaar oud zijn. 
          <%} else {%>
              Bij de instellingen zijn geen devices geselecteerd die kunnen meetellen als draagbare computers. Hierdoor kunnen er mogelijk geen punten worden behaald op dit onderdeel.
          <%}%>
          Het streefaantal draagbare computers op <%=school.name%> is <%=result.standard.hardware.laptopsPerSchool.standard%>.
        Pillars heeft het totale aantal devices die voldoen aan de standaard op <%=school.name%> vastgesteld op <strong><%=result.hardware.goodLaptops%></strong>.
        <%if(result.hardware.missingLaptops === 0){%>
         Er zijn dus op dit moment voldoende draagbare computers aanwezig die voldoen aan de minimale eisen en de maximale score van 
          <%=result.standard.hardware.laptopsPerSchool.maxScore%> is op dit onderdeel toegekend.</p>
        <%} else {%>
          Er ontbreken dus <strong><%=result.hardware.missingLaptops%></strong> draagbare devices op <%=school.name%>. Wij raden aan om de ontbrekende draagbare computers aan te schaffen. Op dit moment zijn slechts <%=result.hardware.portableComputersPerSchool.toFixed(1)%> van maximaal <%=result.standard.hardware.laptopsPerSchool.maxScore%> punten toegekend op dit onderdeel.</p> 
        <%}%>
      <%}%>
      <div class="ui stackable grid">
        <div class="five wide column">
          <div class="ui horizontal small statistics">
            <% var hardwareStatistics = [{'id': 'computersPerStudent', 'label': 'Computers', 'color': 'red'},{'id': 'digitalSchoolbordsPerClassroom', 'label': 'Digitale schoolborden', 'color': 'blue'},{'id': 'network', 'label': 'Netwerk', 'color': 'yellow'},{'id': 'portableComputersPerSchool', 'label': 'Draagbare computers', 'color': ''}] %>
            <%hardwareStatistics.forEach(function(hardwareStatistic){%>
              <div class="<%=hardwareStatistic.color%> statistic">
                <div class="value">
                  <%= result.hardware && result.hardware[hardwareStatistic.id]
                        ? result.hardware[hardwareStatistic.id].toFixed(1).replace('.', ',') : '0,0'%>
                </div>
                <div class="label">
                  <%=hardwareStatistic.label%>
                </div>
              </div>
            <%})%>        
          </div>
        </div>
        <div class="eleven wide column">
            <canvas id="hardware"></canvas>
        </div>
      </div>
      <!--SOFTWARE-->
      <div class="ui horizontal divider">
        Digitale Leermiddelen
      </div>
      <% var primaryLabels = ["Rekenen", "Technisch lezen", "Begrijpend lezen", "Spelling", "Taal", "Toetsenbordvaardigheid", "Programmeren", "Mediawijsheid"];%>
      <% var secondaryLabels = ["Aardrijkskunde", "Biologie", "Duits", "Economie", "Engels", "Frans", "Geschiedenis",  
               "Natuurkunde", "Nederlands", "Scheikunde", "Wiskunde"]%>
      <% var softwareColors = ['red', 'blue', 'yellow', '', 'green', 'orange', 'pink', 'grey'];%>
      <% var softwareStatistics = Object.keys(result.standard.software).map(function(key, i){
              return {id: key, label: school.isSecondarySchool ? secondaryLabels[i] : primaryLabels[i], color: softwareColors[i]}
            })%>
      <%if(!school.isSecondarySchool){%>
        <%softwareStatistics.forEach(function(softwareStatistic){%>
          <h3 class="ui header"><%=softwareStatistic.label%></h3>
          <p>Voor het vak <%=softwareStatistic.label%> kunnen punten worden verdiend als er kwalitatief goede digitale leermiddelen zijn voor <%=result.standard.software[softwareStatistic.id].gradeLevels.join(', ')%> met functionaliteit voor <%=result.standard.software[softwareStatistic.id].functionalities.join(', ')%>.
          <%if(result.software[softwareStatistic.id] > 0){%>
            Dit is het geval, en daarom is de maximale score van <%=result.standard.software[softwareStatistic.id].maxScore%> toegekend.
          <%} else {%>
            Dit is niet het geval en daarom zijn er op dit onderdeel geen punten toegekend.
          <%}%>
           </p>
        <%})%> 
      <%}%>
      <div class="ui stackable grid">
        <div class="five wide column">
          <div class="ui horizontal small statistics">
            <%softwareStatistics.forEach(function(softwareStatistic){%>
              <div class="<%=softwareStatistic.color%> statistic">
                <div class="value">
                  <%= result.software && result.software[softwareStatistic.id]
                        ? result.software[softwareStatistic.id].toFixed(1).replace('.', ',') : '0,0'%>
                </div>
                <div class="label">
                  <%=softwareStatistic.label%>
                </div>
              </div>
            <%})%>        
          </div>
        </div>
        <div class="eleven wide column">
            <% if(school.isSecondarySchool) { %>
              <canvas id="softwareSS"></canvas>
            <%} else { %>
              <canvas id="software"></canvas>
            <% } %>
        </div>
      </div>
      <!--COMPETENCE-->
      <div class="ui horizontal divider">
        Deskundigheid
      </div>
      <%var competenceLabels = ["ICT Geletterdheid", "Pedagogisch Didactisch Handelen", "Werken in de schoolcontext", 
                                "Persoonlijke Ontwikkeling", "Instumentele vaardigheden", "Informatievaardigheden", "Mediawijsheid"];
        var competenceIds = ['ictSkills', 'pedagogicalDidacticalSkills', 'workInSchoolContext', 'personalDevelopment', 'instrumentalSkills',
                                'informationSkills', 'mediaSkills'];
        var competenceStatistics = [];
        var j = 0
        Object.keys(result.standard.competence).forEach(function(key){
            if(result.standard.competence[key].maxScore !== '0'){
                let index = competenceIds.findIndex(cid => cid  === key);
                if(index>-1){
                    competenceStatistics.push({id: key, label: competenceLabels[index], color: softwareColors[j]});
                    j++;
                }
            }
        });
      %>
      <h3 class="ui header">Deskundigheidstests</h3>
      <p>Op de <%=school.name%> zijn deskundigheidstests afgenomen op de gebieden <%=competenceStatistics.map(cs => cs.label).join(', ')%>. 
        Bij de <a href="/schools/<%=school._id%>/pillars/settings">instellingen</a> kan een tijdrange worden ingesteld die mogelijk van toepassing is op de berekening. 
        <%if(school.timeRange ==='ALL'){%>
          Op dit moment is er geen tijdrange geselecteerd en worden alle testresultaten (ook van eventueel reeds gearchiveerde tests) meegeteld.
        <%} else {%>
          Op dit moment is er een tijdrange van toepassing (<%=school.timeRange%>) en worden tests gefilterd op basis van deze tijdrange om de score te bepalen.
        <%}%>
        Voor een uitgebreide analyze van deskundigheidstests, verwijzen wij je naar het <a href="/schools/<%=school._id%>/competence">tabblad Deskundigheid</a>. Hier kun je iedere enquête uitvoerig analyzeren.
      </p>
     <%competenceStatistics.forEach(function(competenceStatistic){%>
      <h3 class="ui header"><%=competenceStatistic.label%></h3>
      <p>Op dit onderdeel is de maximale score <%=result.standard.competence[competenceStatistic.id].maxScore%>. Door het gemiddelde resultaat van alle deelnemers op het testonderdeel <%=competenceStatistic.label%> (in procenten) te vermenigvuldigen met de maximale score zijn er <%= result.competence && result.competence[competenceStatistic.id]
                        ? result.competence[competenceStatistic.id].toFixed(1).replace('.', ',') : '0,0'%> punten toegekend.</p>
     <%})%>
      <div class="ui stackable grid">
        <div class="five wide column">
          <div class="ui horizontal small statistics">
            <%competenceStatistics.forEach(function(competenceStatistic){%>
              <div class="<%=competenceStatistic.color%> statistic">
                <div class="value">
                  <%= result.competence && result.competence[competenceStatistic.id]
                        ? result.competence[competenceStatistic.id].toFixed(1).replace('.', ',') : '0,0'%>
                </div>
                <div class="label">
                  <%=competenceStatistic.label%>
                </div>
              </div>
            <%})%>        
          </div>
        </div>
        <div class="eleven wide column">
            <canvas id="competence"></canvas>
        </div>
      </div>
      
      <!--MANAGEMENT-->
      <div class="ui horizontal divider">
        Organisatie
      </div>
      <h3 class="ui header">Overeenstemming</h3>
      <p>
        Op het onderdeel overeenstemming wordt het maximum aantal punten van <%=result.standard.management.agreement.maxScore%> toegekend, als op het <a href="/schools/<%=school._id%>/management">Tablad Organisatie</a> "Ja" is geantwoord op de vraag "Is er een gedeelde visie op ICT en Onderwijs op deze school?".
        <%if(result.management.agreement === 0){%>
          Dit is niet het geval, en daarom zijn er op dit onderdeel geen punten toegekend.
        <%} else {%>
          Dit is het geval, en dus is zijn er <%= result.management && result.management.agreement
                        ? result.management.agreement.toFixed(1).replace('.', ',') : '0,0'%> punten toegekend.
        <%}%>
      </p>
      <h3 class="ui header">Netwerkbeheer</h3>
      <p>
        Op het onderdeel netwerkbeheer wordt het maximum aantal punten van <%=result.standard.management.network.maxScore%> toegekend, als op het <a href="/schools/<%=school._id%>/management">Tablad Organisatie</a> "Ja" is geantwoord op de drie vragen die betrekking hebben op het netwerkbeheer:
        <ul>
          <li>Functioneert het netwerk goed (bekabeld en ook dekkend draadloos)?</li>
          <li>Worden aanpassing aan het netwerk naar tevredenheid gerealiseerd?</li>
          <li>Worden netwerkincidenten naar tevredenheid opgelost?</li>
        </ul>
        <%if(result.management.network === 0){%>
          Dit is niet het geval, en daarom zijn er op dit onderdeel geen punten toegekend.
        <%} else {%>
          Dit is het geval, en dus is zijn er <%= result.management && result.management.network
                        ? result.management.network.toFixed(1).replace('.', ',') : '0,0'%> punten toegekend.
        <%}%>
      </p>
      <% var personnelStatistics = [{'id': 'incidentReporter', 'label': 'Incidentmelder'},{'id': 'ictEducationalContentManager', 'label': 'Onderwijskundig ICTer'},{'id': 'ictPurchaser', 'label': 'Inkoper'},{'id': 'systemAdministrator', 'label': 'Systeembeheerder'}] %>
      <%personnelStatistics.forEach(function(personnelStatistic){%>
        <h3 class="ui header"><%=personnelStatistic.label%></h3>
        <p>
          Het minimum aantal normjaartaakuren voor de <%=personnelStatistic.label%> is berekend op basis van <%=school.countStudents%> leerlingen op de <%=school.name%>. Het aantal uren voor het leerlingaantal t/m 200 is <%=result.standard.management[personnelStatistic.id].hoursPerYear%> uren en voor elke 100 leerlingen daarboven een extra <%=result.standard.management[personnelStatistic.id].additionalHoursPerYear%> uren. De maximale score op dit onderdeel is <%=result.standard.management[personnelStatistic.id].maxScore%> punten. Punten worden gedeeltelijk toegekend indien er een lager aantal uren beschikbaar is gesteld.
          <%if(result.management[personnelStatistic.id] === 0){%>
            Er zijn geen uren voor deze taak beschikbaar, en daarom zijn er geen punten gegeven op dit onderdeel.
          <%} else if(result.management[personnelStatistic.id] == result.standard.management[personnelStatistic.id].maxScore) {%>
            Er zijn voldoende uren voor deze taak beschikbaar, en daarom is het maximum aantal punten toegekend op dit onderdeel.
          <%} else {%>
            Er is slechts een deel van de uren beschikbaar voor deze taak, en daarom is er een gedeeltelijke score toegekend op dit onderdeel van <%= result.management && result.management[personnelStatistic.id]
                        ? result.management[personnelStatistic.id].toFixed(1).replace('.', ',') : '0,0'%> .
          <%}%>
        </p>
      <%});%>
      <div class="ui stackable grid">
        <div class="five wide column">
          <% var managementStatistics = [{'id': 'agreement', 'label': 'Overeenstemming', 'color': 'red'},{'id': 'network', 'label': 'Netwerkbeheer', 'color': 'blue'},{'id': 'incidentReporter', 'label': 'Incidentmelder', 'color': 'yellow'},{'id': 'ictEducationalContentManager', 'label': 'Onderwijskundig ICTer', 'color': ''},{'id': 'ictPurchaser', 'label': 'Inkoper', 'color': 'green'},{'id': 'systemAdministrator', 'label': 'Systeembeheerder', 'color': 'orange'}] %>
          <div class="ui horizontal small statistics">
            <%managementStatistics.forEach(function(managementStatistic){%>
              <div class="<%=managementStatistic.color%> statistic">
                <div class="value">
                  <%= result.management && result.management[managementStatistic.id]
                        ? result.management[managementStatistic.id].toFixed(1).replace('.', ',') : '0,0'%>
                </div>
                <div class="label">
                  <%=managementStatistic.label%>
                </div>
              </div>
            <%})%>        
          </div>
        </div>
        <div class="eleven wide column">
            <canvas id="management"></canvas>
        </div>
      </div>
    </div>



<% include ../partials/school-footer %>
<% include ../partials/footer %>
