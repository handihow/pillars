<script>

	var mode = $( '#mode' ).text();

  var formsCSSText = $('#formsCSS').text();
  var formsCSS = JSON.parse(formsCSSText);
	
	var hardwareForm;

	if(mode == 'long'){
		hardwareForm = {"locale":"nl","title":{"nl":"Hardware toevoegen"},"completedHtml":{"nl":"Hardware wordt verwerkt..."},"loadingHtml":{"nl":"Even geduld aub..."},"pages":[{"name":"long","elements":[{"type":"dropdown","name":"type","startWithNewLine":false,"title":{"nl":"Type hardware"},"isRequired":true,"choices":["Desktop","Multipoint computer","Laptop","Digitaal schoolbord","Tablet","Chromebook","Telefoon","Kopieermachine","Printer"]},{"type":"text","name":"name","startWithNewLine":false,"title":{"nl":"Naam hardware"},"isRequired":true},{"type":"dropdown","name":"memory","visibleIf":"{type} = \"Desktop\" or {type} = \"Multipoint computer\" or {type} = \"Laptop\" or {type} = \"Chromebook\"","startWithNewLine":false,"title":{"nl":"Werkgeheugen (GB)"},"isRequired":true,"hasOther":true,"choices":[{"value":"2","text":{"nl":"2 GB"}},{"value":"4","text":{"nl":"4 GB"}},{"value":"8","text":{"nl":"8 GB"}},{"value":"16","text":{"nl":"16 GB"}},{"value":"32","text":{"nl":"32 GB"}}],"otherText":{"nl":"Anders, nl."}},{"type":"dropdown","name":"deploymentYear","startWithNewLine":false,"title":{"nl":"Jaar ingebruikname"},"isRequired":true,"hasOther":true,"choices":["2020","2019","2018","2017","2016","2015",{"value":"2014","text":{"nl":"Ouder dan 2014"}},{"value":"0","text":{"nl":"Onbekend"}}],"otherText":{"nl":"Anders, nl."}},{"type":"text","name":"brand","title":{"nl":"Merk"}},{"type":"text","name":"model","startWithNewLine":false,"title":{"nl":"Model"}},{"type":"text","name":"processor","startWithNewLine":false,"title":{"nl":"Processor"}},{"type":"text","name":"serialTag","startWithNewLine":false,"title":{"nl":"Serial/Tag nummer"}},{"type":"text","name":"numberWorkPlacesMultipoint","visibleIf":"{type} = \"Multipoint computer\"","title":{"nl":"Aantal werkplekken multipoint computer"},"isRequired":true,"validators":[{"type":"numeric","minValue":1,"maxValue":5}],"inputType":"number"},{"type":"boolean","name":"isTouchscreenDigibord","visibleIf":"{type} = \"Digitaal schoolbord\"","startWithNewLine":false,"title":{"nl":"Touchscreen Digitaal Schoolbord"},"isRequired":true,"labelTrue":"Ja","labelFalse":"Nee"},{"type":"text","name":"screensizeDigibord","visibleIf":"{type} = \"Digitaal schoolbord\"","startWithNewLine":false,"title":{"nl":"Beelddiagonaal in inch"},"inputType":"number"},{"type":"text","name":"supplier","title":{"nl":"Leverancier"}},{"type":"text","name":"warranty","startWithNewLine":false,"title":{"nl":"Garantievorm"}},{"type":"text","name":"cost","title":{"nl":"Kosten in EURO (afgerond op geheel bedrag)"},"validators":[{"type":"numeric","text":"Nummer tussen 0 en 100000","minValue":0,"maxValue":100000}],"inputType":"number"},{"type":"dropdown","name":"depreciationPeriod","startWithNewLine":false,"title":{"nl":"Afschrijven na hoeveel jaar"},"choices":[{"value":"1","text":{"nl":"1 jaar"}},{"value":"2","text":{"nl":"2 jaar"}},{"value":"3","text":{"nl":"3 jaar"}},{"value":"4","text":{"nl":"4 jaar"}},{"value":"5","text":{"nl":"5 jaar"}},{"value":"6","text":{"nl":"6 jaar"}},{"value":"7","text":{"nl":"7 jaar"}},{"value":"8","text":{"nl":"8 jaar"}},{"value":"9","text":{"nl":"9 jaar"}},{"value":"10","text":{"nl":"10 jaar"}}]},{"type":"text","name":"location","title":{"nl":"Locatie van draagbaar device"},"placeHolder":{"nl":"Laptop kar | directie kantoor | IB-kantoor"}},{"type":"dropdown","name":"functionsAs","visibleIf":"{type} = \"Desktop\" or {type} = \"Laptop\" or {type} = \"Chromebook\"","startWithNewLine":false,"title":{"nl":"Functie device"},"choices":["Leerling device","Medewerker device","Directie device"]}],"title":{"nl":"Uitgebreid invoeren hardware"}}],"showTitle":false,"showPageTitles":false,"showQuestionNumbers":"off"};

  } else {
	 	hardwareForm = {"locale":"nl","title":{"nl":"Hardware toevoegen"},"completedHtml":{"nl":"Hardware wordt verwerkt..."},"loadingHtml":{"nl":"Even geduld aub..."},"pages":[{"name":"short","elements":[{"type":"paneldynamic","name":"hardware","title":{"nl":"Voer hardware in"},"templateElements":[{"type":"dropdown","name":"type","startWithNewLine":false,"title":{"nl":"Type hardware"},"isRequired":true,"choices":["Desktop","Multipoint computer","Laptop","Digitaal schoolbord","Tablet","Chromebook","Telefoon","Kopieermachine","Printer"]},{"type":"text","name":"name","startWithNewLine":false,"title":{"nl":"Naam hardware"},"isRequired":true},{"type":"dropdown","name":"memory","visibleIf":"{panel.type} contains \"Desktop\" or {panel.type} contains \"Multipoint computer\" or {panel.type} contains \"Laptop\" or {panel.type} contains \"Chromebook\"","startWithNewLine":false,"title":{"nl":"Werkgeheugen (GB)"},"isRequired":true,"hasOther":true,"choices":[{"value":"2","text":{"nl":"2 GB"}},{"value":"4","text":{"nl":"4 GB"}},{"value":"8","text":{"nl":"8 GB"}},{"value":"16","text":{"nl":"16 GB"}},{"value":"32","text":{"nl":"32 GB"}},{"value":"0","text":{"nl":"Niet van toepassing"}}],"otherText":{"nl":"Anders, nl."}},{"type":"dropdown","name":"deploymentYear","startWithNewLine":false,"title":{"nl":"Jaar ingebruikname"},"isRequired":true,"hasOther":true,"choices":["2020","2019","2018","2017","2016","2015",{"value":"2014","text":{"nl":"Ouder dan 2014"}},{"value":"0","text":{"nl":"Onbekend"}}],"otherText":{"nl":"Anders, nl."}},{"type":"text","name":"numberDevices","startWithNewLine":false,"title":{"nl":"Aantal apparaten"},"defaultValue":1,"isRequired":true,"validators":[{"type":"numeric","minValue":1,"maxValue":100}],"inputType":"number"},{"type":"text","name":"numberWorkPlacesMultipoint","visibleIf":"{panel.type} = \"Multipoint computer\"","width":"30%","title":{"nl":"Aantal werkplekken per multipoint"},"isRequired":true,"validators":[{"type":"numeric","minValue":1,"maxValue":10}],"inputType":"number"},{"type":"text","name":"screensizeDigibord","visibleIf":"{panel.type} = \"Digitaal schoolbord\"","title":{"nl":"Beelddiagonaal in inches"},"isRequired":true,"inputType":"number"},{"type":"boolean","name":"isTouchscreenDigibord","visibleIf":"{panel.type} = \"Digitaal schoolbord\"","startWithNewLine":false,"title":{"nl":"Touchscreen digitaal schoolbord"},"isRequired":true,"labelTrue":"Ja","labelFalse":"Nee"}],"panelCount":1,"minPanelCount":1,"confirmDelete":true,"confirmDeleteText":{"nl":"Weet je zeker dat je deze regel wilt verwijderen?"},"panelAddText":{"nl":"Regel toevoegen"},"panelRemoveText":{"nl":"Regel verwijderen"}}],"title":{"nl":"Snelle invoer"}}],"showTitle":false,"showPageTitles":false,"showQuestionNumbers":"off"};
	} 

  var survey = new Survey.Model(hardwareForm);
  $("#hardwareForm").Survey({model: survey, css: formsCSS});
  survey.locale = 'nl';

  var schoolId = $( '#schoolId' ).text();
  var url = window.location.origin + "/schools/" + schoolId + "/hardware"; //post url for new hardware

  var isShow = $( '#isShow' ).text();
  var isEdit = $( '#isEdit' ).text();
  var isEditingInModal = false;
  var index = 0;

  if(isShow || isEdit){
    
    var hardwareData = $( '#hardwareData' ).text();

    var hardware = JSON.parse(hardwareData);

    survey.data = hardware;
    
    url = window.location.origin + "/schools/" + schoolId + "/hardware/" + hardware._id;
  
  } 

  if(isShow){

    survey.mode = "display";
  
  }
  
  survey
    .onComplete
    .add(function (result) {
         $.ajax({
          url: url,
          type: "POST",
          data: {
              result: JSON.stringify(result.data),
              mode: mode
          },
          success: function (data) {
            if(data.success){
              if(isEditingInModal){
                survey.clear();
                $('.ui.modal.hardware-modal').modal('hide');
                $('.hardware-row#'+index).addClass('positive');
                $('.hardware-warning.'+index)
                .html(`
                  <i class="info circle icon"></i>
                  Gewijzigd
                `);
              } else {
                window.location.href = window.location.origin + "/schools/" + schoolId +  "/hardware/list";  
              }
            } else {
              alert(data.error);
            }
          },
          error: function(err) {
            alert(err.message ? err.message : 'Er ging iets mis');
          }
      });

    });


    $(".hardware-row").click(function(){
        index = parseInt(this.id);
        var hardwareData = $( '#hardwareData' ).text();
        var hardwareList = JSON.parse(hardwareData);
        var hardware = hardwareList[index];
        survey.data = hardware;
        isEditingInModal = true;
        url = window.location.origin + "/schools/" + schoolId + "/hardware/" + hardware._id;
        $('.ui.modal.hardware-modal').modal('show');
    });

</script>